{% extends "base.html" %}

{% block title %}Profile - Sleep Tracker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6 mx-auto">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title mb-0">
                    <i class="fas fa-user me-2"></i>User Profile
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('profile') }}">
                    
                    <!-- Username and Email (readonly) -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" value="{{ current_user.username }}" readonly>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" value="{{ current_user.email }}" readonly>
                        </div>
                    </div>
                    
                    <!-- Age -->
                    <div class="mb-3">
                        <label for="age" class="form-label">Age</label>
                        <input type="number" class="form-control" id="age" name="age" 
                               value="{{ current_user.age or '' }}" min="1" max="120">
                        <div class="form-text">
                            Used for personalized sleep recommendations
                        </div>
                    </div>
                    
                    <!-- Lifestyle -->
                    <div class="mb-3">
                        <label for="lifestyle" class="form-label">Lifestyle Activity Level</label>
                        <select class="form-select" id="lifestyle" name="lifestyle">
                            <option value="">Select your activity level</option>
                            <option value="Sedentary" {% if current_user.lifestyle == 'Sedentary' %}selected{% endif %}>
                                Sedentary (little to no exercise)
                            </option>
                            <option value="Lightly Active" {% if current_user.lifestyle == 'Lightly Active' %}selected{% endif %}>
                                Lightly Active (light exercise 1-3 days/week)
                            </option>
                            <option value="Moderately Active" {% if current_user.lifestyle == 'Moderately Active' %}selected{% endif %}>
                                Moderately Active (moderate exercise 3-5 days/week)
                            </option>
                            <option value="Very Active" {% if current_user.lifestyle == 'Very Active' %}selected{% endif %}>
                                Very Active (hard exercise 6-7 days/week)
                            </option>
                            <option value="Extremely Active" {% if current_user.lifestyle == 'Extremely Active' %}selected{% endif %}>
                                Extremely Active (very hard exercise, physical job)
                            </option>
                        </select>
                        <div class="form-text">
                            Helps us provide better sleep recommendations
                        </div>
                    </div>
                    
                    <!-- Sleep Goal -->
                    <div class="mb-3">
                        <label for="sleep_goal" class="form-label">Daily Sleep Goal (hours)</label>
                        <input type="range" class="form-range quality-slider" id="sleep_goal" 
                               name="sleep_goal" min="4" max="12" value="{{ current_user.sleep_goal or 8 }}" step="0.5">
                        <div class="d-flex justify-content-between mt-1">
                            <small>4h</small>
                            <small id="sleepGoalValue">{{ current_user.sleep_goal or 8 }}h</small>
                            <small>12h</small>
                        </div>
                        <div class="form-text">
                            Recommended: 7-9 hours for adults
                        </div>
                    </div>
                    
                    <!-- Account Created -->
                    <div class="alert alert-secondary">
                        <small>
                            <i class="fas fa-calendar me-1"></i>
                            Account created: {{ current_user.created_at.strftime('%Y-%m-%d') }}
                        </small>
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Update Profile
                        </button>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Sleep Statistics -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar me-2"></i>Your Sleep Statistics
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <div class="metric-value">{{ total_sleep_logs|default(0) }}</div>
                        <div class="metric-label">Total Logs</div>
                    </div>
                    <div class="col-4">
                        <div class="metric-value">{{ avg_sleep_duration|default(0)|round(1) }}h</div>
                        <div class="metric-label">Avg Duration</div>
                    </div>
                    <div class="col-4">
                        <div class="metric-value">{{ consistency_score|default(0)|round(1) }}%</div>
                        <div class="metric-label">Consistency</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sleep Recommendations Based on Profile -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-lightbulb me-2"></i>Personalized Recommendations
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group">
                    {% if current_user.age %}
                        {% if current_user.age < 18 %}
                        <div class="list-group-item">
                            <i class="fas fa-child text-primary me-2"></i>
                            <strong>Teen Sleep Needs:</strong> Aim for 8-10 hours of sleep per night for optimal growth and development.
                        </div>
                        {% elif current_user.age >= 18 and current_user.age < 65 %}
                        <div class="list-group-item">
                            <i class="fas fa-user text-primary me-2"></i>
                            <strong>Adult Sleep Needs:</strong> 7-9 hours of quality sleep is recommended for adults.
                        </div>
                        {% elif current_user.age >= 65 %}
                        <div class="list-group-item">
                            <i class="fas fa-user-tie text-primary me-2"></i>
                            <strong>Older Adult Sleep:</strong> 7-8 hours of sleep, with more frequent awakenings being normal.
                        </div>
                        {% endif %}
                    {% endif %}
                    
                    {% if current_user.lifestyle %}
                        {% if current_user.lifestyle == 'Sedentary' %}
                        <div class="list-group-item">
                            <i class="fas fa-couch text-warning me-2"></i>
                            <strong>Activity Recommendation:</strong> Try to include light physical activity during the day to improve sleep quality.
                        </div>
                        {% elif current_user.lifestyle == 'Very Active' or current_user.lifestyle == 'Extremely Active' %}
                        <div class="list-group-item">
                            <i class="fas fa-running text-success me-2"></i>
                            <strong>Recovery Focus:</strong> Ensure adequate sleep for muscle recovery and performance maintenance.
                        </div>
                        {% endif %}
                    {% endif %}
                    
                    {% if current_user.sleep_goal %}
                        {% if current_user.sleep_goal < 7 %}
                        <div class="list-group-item">
                            <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                            <strong>Sleep Goal Alert:</strong> Your sleep goal is below the recommended minimum of 7 hours for adults.
                        </div>
                        {% elif current_user.sleep_goal > 9 %}
                        <div class="list-group-item">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            <strong>Sleep Goal Note:</strong> Sleeping more than 9 hours regularly may indicate underlying health issues.
                        </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Update sleep goal value display
        const sleepGoalSlider = document.getElementById('sleep_goal');
        const sleepGoalValue = document.getElementById('sleepGoalValue');
        
        sleepGoalSlider.addEventListener('input', function() {
            sleepGoalValue.textContent = this.value + 'h';
        });
        
        // Initialize value
        sleepGoalValue.textContent = sleepGoalSlider.value + 'h';
    });
</script>
{% endblock %}